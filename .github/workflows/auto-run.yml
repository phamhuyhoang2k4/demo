name: Mine XMR on Nanopool

on:
  workflow_dispatch:

jobs:
  mine-xmr:
    runs-on: ubuntu-latest
    timeout-minutes: 360 # chạy tối đa 6 tiếng mỗi lần

    env:
      POOL: xmr-eu1.nanopool.org:14433
      WALLET: 82tvM9cdwYieKVPKCHx6TJVKbekciy3hSGr54XDEYNYt6atNYkGSeeSS9qrVyjjrufMeyTaiBBTAWFuZG11gdKMc1a31YMG.worker1/myemail@gmail.com
      XMRIG_URL: https://github.com/xmrig/xmrig/releases/download/v6.24.0/xmrig-6.24.0-linux-static-x64.tar.gz

    steps:
      - name: 🧱 Cài đặt môi trường
        run: |
          sudo apt update -y
          sudo apt install -y wget curl

      - name: 📦 Tải và giải nén XMRig
        run: |
          mkdir -p ~/xmrig
          cd ~/xmrig
          wget -q $XMRIG_URL -O xmrig.tar.gz
          tar -xzf xmrig.tar.gz --strip-components=1
          chmod +x xmrig

      - name: ⚙️ Bắt đầu đào XMR
        run: |
          cd ~/xmrig
          echo "🚀 Bắt đầu đào Monero trên Nanopool..."
          ./xmrig -o $POOL -u $WALLET --tls -a rx/0 -k --donate-level=1 | tee miner.log

      - name: 📊 Hiển thị 20 dòng log cuối cùng khi kết thúc
        if: always()
        run: |
          echo "==================== LAST LOGS ===================="
          tail -n 20 ~/xmrig/miner.log || true
